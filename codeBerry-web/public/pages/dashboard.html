<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="shortcut icon" type="imagex/png" href="../img/logo/logoIcone.ico">
  <link rel="stylesheet" href="../css/dash.css">
  <link rel="stylesheet" href="../css/header.css">
  <link rel="stylesheet" href="../css/main.css">
  <link rel="stylesheet" href="../css/footer.css">
  <link rel="stylesheet" href="../css/body.css">

</head>

<body onload="carregarCaminhoes()">

  <div class="header">

    <div class="container">
      <div class="logo-nome">
        <a href="../pages/
        index.html">
          <img src="../assets/img/logo/logoCurta.png" class="logo" alt="Logo da Code Berry">
        </a>
        <h1 class="nome">CodeBerry</h1>
      </div>

      <ul class="navbar">
        <li class="agora">
          <a href="../pages/index.html">Home</a>
        </li>
        <li class="agora">
          <a href="../pages/sobrenos.html">Sobre</a>
        </li>
        <li>
          <a href="../pages/calculadora.html">Simulador</a>
        </li>
        <li>|</li>


        <div class="botao">

          <button class="login">
            <a href="../pages/login.html">Login</a>
          </button>

          <button class="cadastro">
            <a href="../pages/cadastro.html">Cadastro</a>
          </button>

        </div>
      </ul>
    </div>
  </div><br>

  <h1>Caminhões Cadastrados</h1>
  <div id="containerCaminhoes" class="container-caminhoes"></div>


</body>

<script>
  function carregarCaminhoes() {
    var cnpjEmpresa = sessionStorage.getItem("CNPJ_EMPRESA");
    console.log("CNPJ carregado na dashboard:", cnpjEmpresa);

    fetch("/dashboard/caminhoes/" + cnpjEmpresa)
      .then(function (resposta) {
        return resposta.json();
      })
      .then(function (caminhoes) {
        var container = document.getElementById("containerCaminhoes");
        container.innerHTML = "";

        for (var i = 0; i < caminhoes.length; i++) {
          var caminhao = caminhoes[i];

          var div = document.createElement("div");
          div.className = "card-caminhao";

          if (caminhao.alerta) {
            div.classList.add("alerta");
          }

          div.innerHTML = `
            <h2>${caminhao.placa}</h2>
            <p>ID: ${caminhao.idCaminhao}</p>
          `;

          div.onclick = (function (id) {
            return function () {
              window.location.href = "dashboardCaminhao.html?id=" + id;
            };
          })(caminhao.idCaminhao);

          container.appendChild(div);
        }
      })
      .catch(function (erro) {
        console.error("Erro ao buscar caminhões:", erro);
      });
  }
</script>

</html>